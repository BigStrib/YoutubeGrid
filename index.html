<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Video Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            overflow: hidden;
            height: 100vh;
        }

        /* Floating icon - always invisible unless directly hovered */
        #floatingIcon {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 44px;
            height: 44px;
            background: #1a1a1a;
            border: 2px solid #2a2a2a;
            border-radius: 8px;
            cursor: pointer;
            z-index: 10000;
            opacity: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            font-size: 18px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.8);
        }

        #floatingIcon:hover {
            opacity: 1;
            background: #2a2a2a;
            border-color: #3a3a3a;
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.9);
        }

        /* Add icon SVG */
        .add-icon {
            width: 20px;
            height: 20px;
            fill: #cccccc;
        }

        /* Search panel */
        #searchPanel {
            position: fixed;
            top: 75px;
            left: 20px;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.9);
            z-index: 9999;
            display: none;
            min-width: 320px;
        }

        .search-input-container {
            position: relative;
            margin-bottom: 15px;
        }

        .search-input-container svg {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            fill: #666666;
            pointer-events: none;
        }

        #searchPanel input {
            width: 100%;
            padding: 12px 12px 12px 36px;
            border: 1px solid #2a2a2a;
            background: #0a0a0a;
            color: #cccccc;
            font-size: 14px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        #searchPanel input:focus {
            outline: none;
            border-color: #404040;
            background: #141414;
        }

        #searchPanel input::placeholder {
            color: #555555;
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        .icon-button {
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            padding: 12px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s ease;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 44px;
        }

        .icon-button:hover {
            background: #3a3a3a;
            border-color: #4a4a4a;
            transform: translateY(-1px);
        }

        .icon-button svg {
            width: 18px;
            height: 18px;
            fill: #cccccc;
        }

        .icon-button.primary {
            background: #4a1a1a;
            border-color: #5a2a2a;
        }

        .icon-button.primary:hover {
            background: #5a2a2a;
            border-color: #6a3a3a;
        }

        .icon-button.primary svg {
            fill: #cc6666;
        }

        /* Video container - no shadows, no borders, no rounding, no spacing */
        .video-container {
            position: absolute;
            cursor: default;
            transition: all 0.1s ease;
            background: #0a0a0a;
        }

        .video-container.dragging {
            cursor: move;
            z-index: 1000;
        }

        .video-container.resizing {
            transition: none;
        }

        .video-container iframe {
            display: block;
            border: none;
        }

        /* Video controls */
        .video-controls {
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            display: flex;
            justify-content: space-between;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .video-container:hover .video-controls {
            opacity: 1;
        }

        .control-btn {
            width: 32px;
            height: 32px;
            background: rgba(0,0,0,0.9);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            backdrop-filter: blur(8px);
        }

        .control-btn:hover {
            background: rgba(0,0,0,0.95);
            border-color: rgba(255,255,255,0.2);
            transform: translateY(-1px);
        }

        .control-btn svg {
            width: 14px;
            height: 14px;
            fill: #cccccc;
        }

        .move-btn:hover {
            background: rgba(90,42,42,0.9);
            border-color: rgba(204,102,102,0.6);
        }

        .move-btn:hover svg {
            fill: #cc6666;
        }

        .delete-btn:hover {
            background: rgba(90,42,42,0.9);
            border-color: rgba(204,102,102,0.6);
        }

        .delete-btn:hover svg {
            fill: #cc6666;
        }

        /* Resize handles */
        .resize-handle {
            position: absolute;
            background: #404040;
            opacity: 0;
            transition: all 0.2s ease;
            border-radius: 2px;
        }

        .video-container:hover .resize-handle {
            opacity: 0.7;
        }

        .resize-handle:hover {
            opacity: 1;
            background: #505050;
        }

        .resize-se {
            bottom: -6px;
            right: -6px;
            width: 12px;
            height: 12px;
            cursor: se-resize;
        }

        .resize-sw {
            bottom: -6px;
            left: -6px;
            width: 12px;
            height: 12px;
            cursor: sw-resize;
        }

        .resize-ne {
            top: -6px;
            right: -6px;
            width: 12px;
            height: 12px;
            cursor: ne-resize;
        }

        .resize-nw {
            top: -6px;
            left: -6px;
            width: 12px;
            height: 12px;
            cursor: nw-resize;
        }

        /* Size indicator */
        .size-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            color: #cccccc;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-family: monospace;
            z-index: 10001;
            display: none;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* Grid overlay */
        #gridOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            background-image: 
                linear-gradient(to right, rgba(255,255,255,0.02) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 10px 10px;
            opacity: 0;
        }

        .show-grid #gridOverlay {
            opacity: 1;
        }

        /* Tooltip */
        .tooltip {
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            color: #cccccc;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
            z-index: 10002;
        }

        .icon-button:hover .tooltip,
        .control-btn:hover .tooltip {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div id="floatingIcon">
        <svg class="add-icon" viewBox="0 0 24 24">
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
        </svg>
    </div>
    
    <div id="searchPanel">
        <div class="search-input-container">
            <svg viewBox="0 0 24 24">
                <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/>
            </svg>
            <input type="text" id="urlInput" placeholder="Paste YouTube URL...">
        </div>
        <div class="button-group">
            <button class="icon-button primary" onclick="addVideo()">
                <svg viewBox="0 0 24 24">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                </svg>
                <div class="tooltip">Add Video</div>
            </button>
            <button class="icon-button" onclick="closeSearch()">
                <svg viewBox="0 0 24 24">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
                <div class="tooltip">Cancel</div>
            </button>
        </div>
    </div>

    <div id="gridOverlay"></div>
    <div class="size-indicator" id="sizeIndicator"></div>

    <script>
        let isDragging = false;
        let isResizing = false;
        let currentElement = null;
        let startX = 0;
        let startY = 0;
        let startWidth = 0;
        let startHeight = 0;
        let startLeft = 0;
        let startTop = 0;
        let resizeDirection = '';
        let videoCounter = 0;
        let allVideos = [];

        const GRID_SIZE = 10; // Smaller grid for smoother movement
        const SNAP_THRESHOLD = 20; // Distance threshold for size snapping

        // Toggle search panel
        document.getElementById('floatingIcon').addEventListener('click', function() {
            const panel = document.getElementById('searchPanel');
            const isVisible = panel.style.display === 'block';
            panel.style.display = isVisible ? 'none' : 'block';
            if (!isVisible) {
                document.getElementById('urlInput').focus();
            }
        });

        function closeSearch() {
            document.getElementById('searchPanel').style.display = 'none';
            document.getElementById('urlInput').value = '';
        }

        // Extract YouTube video ID from URL
        function getYouTubeVideoId(url) {
            const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[7].length === 11) ? match[7] : null;
        }

        // Snap to grid with smoother movement
        function snapToGrid(value, fineSnap = false) {
            const gridSize = fineSnap ? 5 : GRID_SIZE;
            return Math.round(value / gridSize) * gridSize;
        }

        // Find videos with similar sizes for snapping
        function findSimilarSizes(currentVideo, targetWidth, targetHeight) {
            const similarSizes = [];
            
            allVideos.forEach(video => {
                if (video === currentVideo) return;
                
                const rect = video.getBoundingClientRect();
                const widthDiff = Math.abs(rect.width - targetWidth);
                const heightDiff = Math.abs(rect.height - targetHeight);
                
                if (widthDiff <= SNAP_THRESHOLD && heightDiff <= SNAP_THRESHOLD) {
                    similarSizes.push({
                        width: rect.width,
                        height: rect.height,
                        element: video
                    });
                }
            });
            
            return similarSizes;
        }

        // Get snapped size
        function getSnappedSize(currentVideo, width, height) {
            const similarSizes = findSimilarSizes(currentVideo, width, height);
            
            if (similarSizes.length > 0) {
                // Find the closest match
                let closest = similarSizes[0];
                let closestDistance = Math.abs(closest.width - width) + Math.abs(closest.height - height);
                
                similarSizes.forEach(size => {
                    const distance = Math.abs(size.width - width) + Math.abs(size.height - height);
                    if (distance < closestDistance) {
                        closest = size;
                        closestDistance = distance;
                    }
                });
                
                return { width: closest.width, height: closest.height };
            }
            
            return { width, height };
        }

        // Update size indicator
        function updateSizeIndicator(width, height, show = true) {
            const indicator = document.getElementById('sizeIndicator');
            if (show) {
                indicator.textContent = `${Math.round(width)} Ã— ${Math.round(height)}`;
                indicator.style.display = 'block';
            } else {
                indicator.style.display = 'none';
            }
        }

        // Create control buttons
        function createControlButton(type) {
            const button = document.createElement('div');
            button.className = `control-btn ${type}-btn`;
            
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            
            if (type === 'move') {
                button.innerHTML = `
                    <svg viewBox="0 0 24 24">
                        <path d="M13,11H18L16.5,9.5L17.92,8.08L21.84,12L17.92,15.92L16.5,14.5L18,13H13V18L14.5,16.5L15.92,17.92L12,21.84L8.08,17.92L9.5,16.5L11,18V13H6L7.5,14.5L6.08,15.92L2.16,12L6.08,8.08L7.5,9.5L6,11H11V6L9.5,7.5L8.08,6.08L12,2.16L15.92,6.08L14.5,7.5L13,6V11Z"/>
                    </svg>
                `;
                tooltip.textContent = 'Move';
                button.addEventListener('mousedown', (e) => {
                    e.stopPropagation();
                    startMove(e, button.closest('.video-container'));
                });
            } else if (type === 'delete') {
                button.innerHTML = `
                    <svg viewBox="0 0 24 24">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                `;
                tooltip.textContent = 'Delete';
                button.addEventListener('click', (e) => {
                    e.stopPropagation();
                    removeVideo(button.closest('.video-container'));
                });
            }
            
            button.appendChild(tooltip);
            return button;
        }

        // Add video to page
        function addVideo() {
            const url = document.getElementById('urlInput').value.trim();
            if (!url) return;

            const videoId = getYouTubeVideoId(url);
            if (!videoId) {
                alert('Please enter a valid YouTube URL');
                return;
            }

            videoCounter++;
            const container = document.createElement('div');
            container.className = 'video-container';
            container.id = 'video-' + videoCounter;
            
            const iframe = document.createElement('iframe');
            iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=0&controls=1&modestbranding=1&rel=0`;
            iframe.width = '320';
            iframe.height = '180';
            iframe.frameBorder = '0';
            iframe.allowFullscreen = true;

            // Add control buttons - move on left, delete on right
            const controlsContainer = document.createElement('div');
            controlsContainer.className = 'video-controls';
            
            controlsContainer.appendChild(createControlButton('move'));
            controlsContainer.appendChild(createControlButton('delete'));

            // Add resize handles
            const handles = ['nw', 'ne', 'sw', 'se'];
            handles.forEach(direction => {
                const handle = document.createElement('div');
                handle.className = `resize-handle resize-${direction}`;
                handle.addEventListener('mousedown', (e) => startResize(e, container, direction));
                container.appendChild(handle);
            });

            container.appendChild(iframe);
            container.appendChild(controlsContainer);
            
            // Position new video
            container.style.left = snapToGrid(100 + (videoCounter * 30)) + 'px';
            container.style.top = snapToGrid(100 + (videoCounter * 30)) + 'px';

            document.body.appendChild(container);
            allVideos.push(container);

            closeSearch();
        }

        // Remove video
        function removeVideo(container) {
            const index = allVideos.indexOf(container);
            if (index > -1) {
                allVideos.splice(index, 1);
            }
            container.remove();
        }

        // Start move
        function startMove(e, container) {
            isDragging = true;
            currentElement = container;
            container.classList.add('dragging');
            
            const rect = container.getBoundingClientRect();
            startX = e.clientX - rect.left;
            startY = e.clientY - rect.top;
            
            document.addEventListener('mousemove', handleMove);
            document.addEventListener('mouseup', stopMove);
            e.preventDefault();
        }

        // Handle move
        function handleMove(e) {
            if (!isDragging || !currentElement) return;

            let newX = e.clientX - startX;
            let newY = e.clientY - startY;

            // Use finer snapping during movement
            newX = snapToGrid(newX, true);
            newY = snapToGrid(newY, true);

            // Constrain to viewport
            const rect = currentElement.getBoundingClientRect();
            const maxX = window.innerWidth - rect.width;
            const maxY = window.innerHeight - rect.height;

            newX = Math.max(0, Math.min(newX, maxX));
            newY = Math.max(0, Math.min(newY, maxY));

            currentElement.style.left = newX + 'px';
            currentElement.style.top = newY + 'px';
        }

        // Stop move
        function stopMove() {
            if (!isDragging || !currentElement) return;
            
            isDragging = false;
            currentElement.classList.remove('dragging');
            currentElement = null;
            
            document.removeEventListener('mousemove', handleMove);
            document.removeEventListener('mouseup', stopMove);
        }

        // Start resizing
        function startResize(e, element, direction) {
            isResizing = true;
            currentElement = element;
            resizeDirection = direction;
            element.classList.add('resizing');
            
            const rect = element.getBoundingClientRect();
            startX = e.clientX;
            startY = e.clientY;
            startWidth = rect.width;
            startHeight = rect.height;
            startLeft = rect.left;
            startTop = rect.top;

            document.addEventListener('mousemove', handleResize);
            document.addEventListener('mouseup', stopResize);
            document.body.classList.add('show-grid');
            e.preventDefault();
            e.stopPropagation();
        }

        // Handle resizing
        function handleResize(e) {
            if (!isResizing || !currentElement) return;

            const deltaX = e.clientX - startX;
            const deltaY = e.clientY - startY;

            let newWidth = startWidth;
            let newHeight = startHeight;
            let newLeft = startLeft;
            let newTop = startTop;

            // Calculate new dimensions based on resize direction
            if (resizeDirection.includes('e')) {
                newWidth = Math.max(160, startWidth + deltaX);
            }
            if (resizeDirection.includes('w')) {
                newWidth = Math.max(160, startWidth - deltaX);
                newLeft = startLeft + deltaX;
            }
            if (resizeDirection.includes('s')) {
                newHeight = Math.max(90, startHeight + deltaY);
            }
            if (resizeDirection.includes('n')) {
                newHeight = Math.max(90, startHeight - deltaY);
                newTop = startTop + deltaY;
            }

            // Maintain aspect ratio (16:9 for YouTube)
            const aspectRatio = 16 / 9;
            if (Math.abs(deltaX) > Math.abs(deltaY)) {
                newHeight = newWidth / aspectRatio;
            } else {
                newWidth = newHeight * aspectRatio;
            }

            // Snap to similar sizes
            const snappedSize = getSnappedSize(currentElement, newWidth, newHeight);
            newWidth = snappedSize.width;
            newHeight = snappedSize.height;

            // Snap to grid for precise positioning
            newWidth = snapToGrid(newWidth);
            newHeight = snapToGrid(newHeight);

            // Update size indicator
            updateSizeIndicator(newWidth, newHeight);

            // Constrain to viewport
            const maxX = window.innerWidth - newWidth;
            const maxY = window.innerHeight - newHeight;

            if (resizeDirection.includes('w')) {
                newLeft = Math.max(0, Math.min(newLeft, maxX));
                newLeft = snapToGrid(newLeft, true);
            }
            if (resizeDirection.includes('n')) {
                newTop = Math.max(0, Math.min(newTop, maxY));
                newTop = snapToGrid(newTop, true);
            }

            // Apply new dimensions
            currentElement.style.width = newWidth + 'px';
            currentElement.style.height = newHeight + 'px';
            
            if (resizeDirection.includes('w') || resizeDirection.includes('n')) {
                currentElement.style.left = newLeft + 'px';
                currentElement.style.top = newTop + 'px';
            }

            const iframe = currentElement.querySelector('iframe');
            iframe.width = newWidth;
            iframe.height = newHeight;
        }

        // Stop resizing
        function stopResize() {
            if (!isResizing || !currentElement) return;
            
            isResizing = false;
            currentElement.classList.remove('resizing');
            currentElement = null;
            resizeDirection = '';
            
            document.removeEventListener('mousemove', handleResize);
            document.removeEventListener('mouseup', stopResize);
            document.body.classList.remove('show-grid');
            updateSizeIndicator(0, 0, false);
        }

        // Handle Enter key in URL input
        document.getElementById('urlInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addVideo();
            }
        });

        // Close search panel when clicking outside
        document.addEventListener('click', function(e) {
            const panel = document.getElementById('searchPanel');
            const icon = document.getElementById('floatingIcon');
            
            if (!panel.contains(e.target) && !icon.contains(e.target)) {
                panel.style.display = 'none';
            }
        });
    </script>
</body>
</html>
